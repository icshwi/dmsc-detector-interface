# ESS Detector group FPGA demonstrator database
# $(SYS)    		= The System (DG)
# $(DEV) 			= The DEV name (FPGA)
# $(REG0) 			= Address Offset
# $(SFX) 			= register suffix
# $(COM)			= COM port for stream DEV
# $(PRO) 			= stream DEV protocol filename
# $(DEFAULT=0)      = the default value
# $(MIN=0)          = the minimum allowable value
# $(MAX=2147483647) = the maximum allowable value
# $(SCAN="Passive") = scan rate in seconds
# $(PINI="1")       = Process on init


## Communication Records ###


record(longin, "$(SYS)-$(DEV):$(SFX)-OFF"){
    field(DESC, "signed address offset")
    field(VAL, "$(REG0)")
}

record(longout, "$(SYS)-$(DEV):$(SFX)-SP"){

  field(DESC, "$(SFX) Set Point")
  field(OUT,  "@$(PRO) write1Reg($(SYS)-$(DEV):$(SFX)) $(COM)")
  field(DTYP, "stream")
  field(DRVL, "$(MIN=0)")
  field(DRVH, "$(MAX=2147483647)")
  field(FLNK, "$(SYS)-$(DEV):$(SFX)-RBV")
  field(PINI, "$(PINI="1")")
  field(SDIS, "$(SYS)-$(DEV):$(SFX)-ENA")
  field(DISV, "0")
  info(autosaveFields_pass0, "VAL")
}

# If PINI is set to 0 we don't want "$(SYS)-$(DEV):$(SFX)-SP" to process 
# until we enable it. After we enable it we want it to bupdate with whatever 
# autosave had for it.

record(bo, "$(SYS)-$(DEV):$(SFX)-ENA"){

  field(DESC, "Enable PV")
  field(VAL,  "$(PINI=1)")
  field(FLNK, "$(SYS)-$(DEV):$(SFX)-SP") #So that it processes, updating whatever we used for autosave
  
}

record(longin, "$(SYS)-$(DEV):$(SFX)-ECHO"){
  field(DESC, "$(SFX) write echo")
}

record(longin, "$(SYS)-$(DEV):$(SFX)-RBV"){

  field(DTYP, "stream")
  field(INP,  "@$(PRO) read1Reg($(SYS)-$(DEV):$(SFX)) $(COM)")
  field(SCAN, "$(SCAN="Passive")")
  field(EGU,  "$(EGU="")")
  field(SDIS, "$(SYS)-$(DEV):$(SFX)-ENA")
  field(DISV, "0")
}


