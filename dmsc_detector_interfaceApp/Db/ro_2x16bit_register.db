# ESS Detector group FPGA demonstrator database
# $(SYS)    	= The System (DG)
# $(DEV) 	= The DEV name (FPGA)
# $(DESC) 	= The DEV name (FPGA)
# $(REG) 	= name of register
# $(OFF) = register offset
# $(NR1) = Device/reg number 1
# $(NR2) = Device/reg number 2
# $(SCAN_EVNT) = Event number that scans all RBVs

record(longin, "$(SYS)-$(DEV):$(REG)$(NR1)$(NR2)-OFF") {
  field(VAL, "$(OFF)")
}

record(longin, "$(SYS)-$(DEV):$(REG)$(NR1)$(NR2)-RAW-RBV") {
  field(DESC, "(RAW) $(DESC) $(NR1), $(NR2)")
  field(DTYP, "stream")
  field(INP, "@ics-dg.proto readRegister($(SYS)-$(DEV),$(REG)$(NR1)$(NR2)-OFF) $(COM)")
  field(PINI, "1")
  field(FLNK, "$(SYS)-$(DEV):$(REG)$(NR1)-RBV")
  field(SCAN, "Event")
  field(EVNT, "$(SCAN_EVNT)")
}

record(calc,"$(SYS)-$(DEV):$(REG)$(NR1)-RBV") {
    field(CALC,"A & 0xFFFF")
    field(DESC, "$(DESC) $(NR1)")
    field(INPA,"$(SYS)-$(DEV):$(REG)$(NR1)$(NR2)-RAW-RBV NPP")
    field(FLNK, "$(SYS)-$(DEV):$(REG)$(NR2)-RBV")
}

record(calc,"$(SYS)-$(DEV):$(REG)$(NR2)-RBV") {
    field(DESC, "$(DESC) $(NR2)")
    field(CALC,"(A >> 16)<0?(A >> 16) + 65536:(A >> 16)")
    field(INPA,"$(SYS)-$(DEV):$(REG)$(NR1)$(NR2)-RAW-RBV NPP")
}



