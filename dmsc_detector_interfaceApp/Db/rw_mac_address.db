# ESS Detector group FPGA demonstrator database
# $(SYS)    = The System (DG)
# $(DEV) 	= The DEV name (FPGA)
# $(REG0)   = lw register offset
# $(REG1)   = uw register offset
# $(SFX)    = Label
# $(COM)	= COM port for stream DEV
# $(PRO)    = stream DEV protocol filename


record(longin, "$(SYS)-$(DEV):$(SFX)-OFF0"){
    field(DESC, "MAC Lower Addr")
    field(VAL, "$(REG0)")
}

record(longin, "$(SYS)-$(DEV):$(SFX)-OFF1"){
    field(DESC, "MAC Upper Addr")
    field(VAL, "$(REG1)")
}

## ----------- Write to the output -------------
record(stringout, "$(SYS)-$(DEV):$(SFX)-SP") {
    field(VAL, "")
    field(PINI, "NO")
    field(FLNK, "$(SYS)-$(DEV):$(SFX)-CLCO")
	info(autosaveFields_pass0, "VAL")
	field(PINI, "1")
}

record(aSub,"$(SYS)-$(DEV):$(SFX)-CLCO")
{
    field(SNAM,"stringToMacAddr")
    field(FTA,"STRING")
    field(NOA,"1")
    field(INPA, "$(SYS)-$(DEV):$(SFX)-SP NPP")
    field(FTVA, "LONG")
    field(OUTA, "$(SYS)-$(DEV):$(SFX)-LWR PP")
    field(NOVA, "1")
    field(FTVB, "LONG")
    field(OUTB, "$(SYS)-$(DEV):$(SFX)-UWR PP")
    field(NOVB, "1")
    field(FLNK, "$(SYS)-$(DEV):$(SFX)-LI")
}


record(longout, "$(SYS)-$(DEV):$(SFX)-LO"){
  field(DESC, "MAC write Packets")
  field(DTYP, "stream")
  field(OUT, "@$(PRO) writeRegister($(SYS)-$(DEV),$(SFX)-OFF0,$(SFX)-LO) $(COM)")
}

record(longout, "$(SYS)-$(DEV):$(SFX)-UO"){
  field(DESC, "MAC write Packets")
  field(DTYP, "stream")
  field(OUT, "@$(PRO) writeRegister($(SYS)-$(DEV),$(SFX)-OFF1,$(SFX)-UO) $(COM)")
}


## ----------- Read back  -------------

record(longin, "$(SYS)-$(DEV):$(SFX)-LI"){
  field(DESC, "MAC read Packets")
  field(DTYP, "stream")
  field(INP, "@$(PRO) readRegister($(SYS)-$(DEV),$(SFX)-OFF0) $(COM)")
  field(FLNK, "$(SYS)-$(DEV):$(SFX)-UI")
}

record(longin, "$(SYS)-$(DEV):$(SFX)-UI"){
  field(DESC,   "MAC read Packets")
  field(DTYP,   "stream")
  field(INP,    "@$(PRO) readRegister($(SYS)-$(DEV),$(SFX)-OFF1) $(COM)")
  field(FLNK,   "$(SYS)-$(DEV):$(SFX)-CLCI")
}

record(aSub,"$(SYS)-$(DEV):$(SFX)-CLCI")
{
    field(SNAM,"macAddrToString")
    field(FTA,  "LONG")
    field(NOA,  "1")
    field(INPA, "$(SYS)-$(DEV):$(SFX)-LI NPP")
    field(FTB,  "LONG")
    field(NOB,  "1")
    field(INPB, "$(SYS)-$(DEV):$(SFX)-UI NPP")
    field(FTVA, "STRING")
    field(OUTA, "$(SYS)-$(DEV):$(SFX)-RBV PP")
    field(NOVA, "1")
}

record(stringin, "$(SYS)-$(DEV):$(SFX)-RBV") {

}
