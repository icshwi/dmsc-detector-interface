# ESS Detector group FPGA demonstrator database
# $(SYS)    = The System (DG)
# $(DEV) 	= The DEV name (FPGA)
# $(REG0)   = lw register offset
# $(REG1)   = uw register offset
# $(SFX)    = Label
# $(COM)	= COM port for stream DEV
# $(PRO)    = stream DEV protocol filename

record(longin, "$(SYS)-$(DEV):$(SFX)-OFF0"){
    field(DESC, "MAC Lower Addr")
    field(VAL, "$(REG0)")
}

record(longin, "$(SYS)-$(DEV):$(SFX)-OFF1"){
    field(DESC, "MAC Upper Addr")
    field(VAL, "$(REG1)")
}

## ----------- Write to the output -------------
record(stringout, "$(SYS)-$(DEV):$(SFX)-SP") {
    field(VAL, "")
    field(FLNK, "$(SYS)-$(DEV):$(SFX)-CLCO")
	info(autosaveFields_pass0, "VAL")
	field(PINI, "1")
}

record(aSub,"$(SYS)-$(DEV):$(SFX)-CLCO")
{
    field(SNAM,"stringToMacAddr")
    field(FTA,"STRING")
    field(NOA,"1")
    field(INPA, "$(SYS)-$(DEV):$(SFX)-SP NPP")
    field(FTVA, "LONG")
    field(OUTA, "$(SYS)-$(DEV):$(SFX)-LW-SP PP")
    field(NOVA, "1")
    field(FTVB, "LONG")
    field(OUTB, "$(SYS)-$(DEV):$(SFX)-UW-SP PP")
    field(NOVB, "1")
    field(FLNK, "$(SYS)-$(DEV):$(SFX)-WR")
}


record(longout, "$(SYS)-$(DEV):$(SFX)-LW-SP"){
  field(DESC, "MAC Lower Packets")
}

record(longout, "$(SYS)-$(DEV):$(SFX)-UW-SP"){
  field(DESC, "MAC Upper Packets")
}

record(bo, "$(SYS)-$(DEV):$(SFX)-WR"){
  field(DESC, "write packets")
  field(OUT,  "@$(PRO) write2Reg($(SYS)-$(DEV):$(SFX),LW-SP,UW-SP) $(COM)")
  field(DTYP, "stream")
  field(FLNK, "$(SYS)-$(DEV):$(SFX)-RD")
}

record(longin, "$(SYS)-$(DEV):$(SFX)-ECHO0"){
  field(DESC, "$(SFX) write echo 1")
}

record(longin, "$(SYS)-$(DEV):$(SFX)-ECHO1"){
  field(DESC, "$(SFX) write echo 2")
}

## ----------- Read back  -------------


record(bi, "$(SYS)-$(DEV):$(SFX)-RD"){
    field(DTYP, "stream")
    field(INP, "@$(PRO) read2Reg($(SYS)-$(DEV):$(SFX),LW-RBV,UW-RBV) $(COM)")
    field(SCAN, "$(SCAN="Passive")")
    field(FLNK, "$(SYS)-$(DEV):$(SFX)-CLCI")
    
}

record(longin, "$(SYS)-$(DEV):$(SFX)-LW-RBV"){
   field(DESC, "Lower word of $(SFX)")
}

record(longin, "$(SYS)-$(DEV):$(SFX)-UW-RBV"){
   field(DESC, "Middle word of $(SFX)")
}

record(aSub,"$(SYS)-$(DEV):$(SFX)-CLCI")
{
    field(SNAM,"macAddrToString")
    field(FTA,  "LONG")
    field(NOA,  "1")
    field(INPA, "$(SYS)-$(DEV):$(SFX)-LW-RBV NPP")
    field(FTB,  "LONG")
    field(NOB,  "1")
    field(INPB, "$(SYS)-$(DEV):$(SFX)-UW-RBV NPP")
    field(FTVA, "STRING")
    field(OUTA, "$(SYS)-$(DEV):$(SFX)-RBV PP")
    field(NOVA, "1")
}

record(stringin, "$(SYS)-$(DEV):$(SFX)-RBV") {
    field(DESC,  "$(SFX) MAC")
}
